{
  "resourceType": "Library",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "https://gravitate-health.lst.tfo.upm.es/ips/api/fhir/Library/592",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "preadmission-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Serious Symptoms Checker Lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacción"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "date": "2026-02-03T10:51:43.678Z",
  "title": "preadmission Lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacción"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "A lens that highlight any information related to interactions between other mediciones or ePIs",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Una lente que resalta cualquier información relacionada con interacciones entre otros medicamentos o ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Uma lente que destaca qualquer informação relacionada com interações entre outros medicamentos ou ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "En linse, der fremhæver al information relateret til interaktioner mellem andre lægemidler eller ePI'er."
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Clarify the important things related to interactions between other ePIs in the ePI provided",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Aclarar los aspectos importantes relacionados con interacciones entre otros ePIs en el ePI proporcionado."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esclarecer os pontos importantes relacionados com interações entre outros ePIs no ePI fornecido."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Klargør de vigtige ting vedrørende interaktioner mellem andre ePI'er i den angivne ePI."
          }
        ]
      }
    ]
  },
  "usage": "This lens requires a preprocessed ePI, and an IPS to work. You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Esta lente requiere una ePI preprocesada y un IPS para funcionar. Puedes importar esta lente directamente en tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esta lente requer uma ePI pré-processada e um IPS para funcionar. Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Denne linse kræver en forbehandlet ePI og en IPS for at fungere. Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwoKbGV0IGdldFNwZWNpZmljYXRpb24gPSAoKSA9PiB7CiAgICByZXR1cm4gIjEuMC4wLXByZWFkbWlzc2lvbi1iYW5uZXIiOwp9OwovL2RvY3VtZW50LCBodG1sRGF0YSwgYmFubmVySFRNTAovLwpjb25zdCBpbnNlcnRRdWVzdGlvbm5haXJlTGluayA9IChsaXN0T2ZDYXRlZ29yaWVzLCBsYW5ndWFnZSwgZG9jdW1lbnQsIHJlc3BvbnNlKSA9PiB7CgogICAgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJwdCIpKSB7CiAgICAgICAgbGlua0hUTUwgPSAiaHR0cHM6Ly9leGFtcGxlLm9yZy9xdWVzdGlvbm5haXJlL2hpZ2gtcmlzayI7CgogICAgfSBlbHNlIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgiZW4iKSkgewogICAgICAgIGxpbmtIVE1MID0gImh0dHBzOi8vZXhhbXBsZS5vcmcvcXVlc3Rpb25uYWlyZS9oaWdoLXJpc2siOwoKICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImVzIikpIHsKICAgICAgICBsaW5rSFRNTCA9ICJodHRwczovL2V4YW1wbGUub3JnL3F1ZXN0aW9ubmFpcmUvaGlnaC1yaXNrIjsKCiAgICB9IGVsc2UgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJkYSIpKSB7CiAgICAgICAgbGlua0hUTUwgPSAiaHR0cHM6Ly9leGFtcGxlLm9yZy9xdWVzdGlvbm5haXJlL2hpZ2gtcmlzayI7CgogICAgfSBlbHNlIHsKICAgICAgICBsaW5rSFRNTCA9ICJodHRwczovL2V4YW1wbGUub3JnL3F1ZXN0aW9ubmFpcmUvaGlnaC1yaXNrIjsKCiAgICB9CiAgICBsZXQgc2hvdWxkQXBwZW5kID0gZmFsc2U7IC8vZm9yIGZ1dHVyZSB1c2FnZQogICAgbGV0IGZvdW5kQ2F0ZWdvcnkgPSBmYWxzZTsKICAgIGNvbnNvbGUubG9nKGxpc3RPZkNhdGVnb3JpZXMpCiAgICBjb25zb2xlLmxvZyhsaXN0T2ZDYXRlZ29yaWVzLmxlbmd0aCkKICAgIGxpc3RPZkNhdGVnb3JpZXMuZm9yRWFjaCgoY2xhc3NOYW1lKSA9PiB7CiAgICAgICAgaWYgKAogICAgICAgICAgICByZXNwb25zZS5pbmNsdWRlcyhgY2xhc3M9IiR7Y2xhc3NOYW1lfWApIHx8CiAgICAgICAgICAgIHJlc3BvbnNlLmluY2x1ZGVzKGBjbGFzcz0nJHtjbGFzc05hbWV9YCkKICAgICAgICApIHsKICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImhyZWYiLCBsaW5rSFRNTCk7CiAgICAgICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgidGFyZ2V0IiwgIl9ibGFuayIpOwogICAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInByZWFkbWlzc2lvbi1sZW5zIik7CgogICAgICAgICAgICAgICAgaWYgKHNob3VsZEFwcGVuZCkgewogICAgICAgICAgICAgICAgICAgIC8vIEFwcGVuZCB0aGUgbGluayBhcyBhIG5ldyBlbGVtZW50IGluc2lkZSB0aGUgZXhpc3RpbmcgZWxlbWVudAogICAgICAgICAgICAgICAgICAgIGxpbmsuaW5uZXJIVE1MID0gIj3dIEZpbGwgb3V0IHNhZmV0eSBxdWVzdGlvbm5haXJlIjsKICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCB0aGUgZXhpc3RpbmcgY29udGVudHMgb2YgdGhlIGVsZW1lbnQgaW4gdGhlIGxpbmsKICAgICAgICAgICAgICAgICAgICBsaW5rLmlubmVySFRNTCA9IGVsLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICBlbC5pbm5lckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3VuZENhdGVnb3J5ID0gdHJ1ZTsKICAgICAgICB9CiAgICB9KTsKCiAgICBjb25zb2xlLmxvZyAoZm91bmRDYXRlZ29yeSk7CiAgICAvLyBObyBtYXRjaGluZyBjYXRlZ29yeSB0YWdzIJIgaW5qZWN0IGJhbm5lciBhdCB0b3AKICAgIGlmICghZm91bmRDYXRlZ29yeSkgewoKICAgICAgICBjb25zdCBiYW5uZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCiAgICAgICAgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJwdCIpKSB7CiAgICAgICAgICAgIGJhbm5lckRpdi5pbm5lckhUTUwgPSBgCjxkaXYgY2xhc3M9ImFsZXJ0LWJhbm5lciBlbWVyZ2VuY3ktY2FsbCBwcmVhZG1pc3Npb24tbGVucyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZjNjZDtwYWRkaW5nOjFlbTtib3JkZXI6MXB4IHNvbGlkICNmNWMyYzc7bWFyZ2luLWJvdHRvbToxZW07Ym9yZGVyLXJhZGl1czo1cHg7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjsiPgogIDxzdHJvbmc+oA8gV2FybmluZyBmb3IgcGF0aWVudHMgd2l0aCBoZWFydCBmYWlsdXJlIHRha2luZyBGdXJvc2VtaWRlPC9zdHJvbmc+PGJyPjxicj4KCiAgRnVyb3NlbWlkZSBoZWxwcyByZWR1Y2UgZmx1aWQgYnVpbGR1cCwgYnV0IGluIHNvbWUgY2FzZXMgaXQgbWF5IGNhdXNlIHNlcmlvdXMgc2lkZSBlZmZlY3RzIHRoYXQgcmVxdWlyZSBpbW1lZGlhdGUgbWVkaWNhbCBhdHRlbnRpb24uIFBsZWFzZSBzdG9wIGFuZCBzZWVrIGVtZXJnZW5jeSBjYXJlIGlmIHlvdSBleHBlcmllbmNlIGFueSBvZiB0aGUgZm9sbG93aW5nOgoKICA8dWwgc3R5bGU9Im1hcmdpbi10b3A6IDFlbTsgbWFyZ2luLWJvdHRvbTogMWVtOyI+CiAgICA8bGk+PHN0cm9uZz5TZXZlcmUgZGl6emluZXNzIG9yIGZhaW50aW5nPC9zdHJvbmc+IBMgbWF5IGluZGljYXRlIGxvdyBibG9vZCBwcmVzc3VyZSBvciBmbHVpZCBsb3NzPC9saT4KICAgIDxsaT48c3Ryb25nPk11c2NsZSBjcmFtcHMgb3Igd2Vha25lc3M8L3N0cm9uZz4gEyBjb3VsZCBiZSBhIHNpZ24gb2YgbG93IHBvdGFzc2l1bTwvbGk+CiAgICA8bGk+PHN0cm9uZz5JcnJlZ3VsYXIgb3IgZmFzdCBoZWFydGJlYXQ8L3N0cm9uZz4gEyBtYXkgaW5kaWNhdGUgYSBzZXJpb3VzIGVsZWN0cm9seXRlIGltYmFsYW5jZTwvbGk+CiAgICA8bGk+PHN0cm9uZz5TdWRkZW4gY2hlc3QgcGFpbjwvc3Ryb25nPiATIHBvc3NpYmxlIGNhcmRpYWMgY29tcGxpY2F0aW9uPC9saT4KICAgIDxsaT48c3Ryb25nPkNvbmZ1c2lvbiBvciBleHRyZW1lIGZhdGlndWU8L3N0cm9uZz4gEyBtYXkgc2lnbmFsIGxvdyBzb2RpdW0gb3IgZGVoeWRyYXRpb248L2xpPgogICAgPGxpPjxzdHJvbmc+SGVhcmluZyBsb3NzIG9yIHJpbmdpbmcgaW4gdGhlIGVhcnM8L3N0cm9uZz4gEyByYXJlIGJ1dCBzZXJpb3VzIGF0IGhpZ2ggZG9zZXM8L2xpPgogICAgPGxpPjxzdHJvbmc+VHJvdWJsZSBicmVhdGhpbmcgb3Igc3dlbGxpbmcgb2YgdGhlIGZhY2UvbGlwczwvc3Ryb25nPiATIHBvc3NpYmxlIGFsbGVyZ2ljIHJlYWN0aW9uPC9saT4KICA8L3VsPgoKICA8YnV0dG9uIG9uY2xpY2s9ImNhbGxFbWVyZ2VuY3lTdXBwb3J0KCkiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNkOTUzNGY7Y29sb3I6d2hpdGU7cGFkZGluZzowLjc1ZW0gMS41ZW07Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo1cHg7Zm9udC13ZWlnaHQ6Ym9sZDtjdXJzb3I6cG9pbnRlcjsiPgogICAgPaggQ29udGFjdCBFbWVyZ2VuY3kgU3VwcG9ydAogIDwvYnV0dG9uPgo8L2Rpdj4KICAgICAgYDsKCiAgICAgICAgfSBlbHNlIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgiZW4iKSkgewogICAgICAgICAgICBiYW5uZXJEaXYuaW5uZXJIVE1MID0gYAo8ZGl2IGNsYXNzPSJhbGVydC1iYW5uZXIgZW1lcmdlbmN5LWNhbGwgcHJlYWRtaXNzaW9uLWxlbnMiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmYzY2Q7cGFkZGluZzoxZW07Ym9yZGVyOjFweCBzb2xpZCAjZjVjMmM3O21hcmdpbi1ib3R0b206MWVtO2JvcmRlci1yYWRpdXM6NXB4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Ij4KICA8c3Ryb25nPqAPIFdhcm5pbmcgZm9yIHBhdGllbnRzIHdpdGggaGVhcnQgZmFpbHVyZSB0YWtpbmcgRnVyb3NlbWlkZTwvc3Ryb25nPjxicj48YnI+CgogIEZ1cm9zZW1pZGUgaGVscHMgcmVkdWNlIGZsdWlkIGJ1aWxkdXAsIGJ1dCBpbiBzb21lIGNhc2VzIGl0IG1heSBjYXVzZSBzZXJpb3VzIHNpZGUgZWZmZWN0cyB0aGF0IHJlcXVpcmUgaW1tZWRpYXRlIG1lZGljYWwgYXR0ZW50aW9uLiBQbGVhc2Ugc3RvcCBhbmQgc2VlayBlbWVyZ2VuY3kgY2FyZSBpZiB5b3UgZXhwZXJpZW5jZSBhbnkgb2YgdGhlIGZvbGxvd2luZzoKCiAgPHVsIHN0eWxlPSJtYXJnaW4tdG9wOiAxZW07IG1hcmdpbi1ib3R0b206IDFlbTsiPgogICAgPGxpPjxzdHJvbmc+U2V2ZXJlIGRpenppbmVzcyBvciBmYWludGluZzwvc3Ryb25nPiATIG1heSBpbmRpY2F0ZSBsb3cgYmxvb2QgcHJlc3N1cmUgb3IgZmx1aWQgbG9zczwvbGk+CiAgICA8bGk+PHN0cm9uZz5NdXNjbGUgY3JhbXBzIG9yIHdlYWtuZXNzPC9zdHJvbmc+IBMgY291bGQgYmUgYSBzaWduIG9mIGxvdyBwb3Rhc3NpdW08L2xpPgogICAgPGxpPjxzdHJvbmc+SXJyZWd1bGFyIG9yIGZhc3QgaGVhcnRiZWF0PC9zdHJvbmc+IBMgbWF5IGluZGljYXRlIGEgc2VyaW91cyBlbGVjdHJvbHl0ZSBpbWJhbGFuY2U8L2xpPgogICAgPGxpPjxzdHJvbmc+U3VkZGVuIGNoZXN0IHBhaW48L3N0cm9uZz4gEyBwb3NzaWJsZSBjYXJkaWFjIGNvbXBsaWNhdGlvbjwvbGk+CiAgICA8bGk+PHN0cm9uZz5Db25mdXNpb24gb3IgZXh0cmVtZSBmYXRpZ3VlPC9zdHJvbmc+IBMgbWF5IHNpZ25hbCBsb3cgc29kaXVtIG9yIGRlaHlkcmF0aW9uPC9saT4KICAgIDxsaT48c3Ryb25nPkhlYXJpbmcgbG9zcyBvciByaW5naW5nIGluIHRoZSBlYXJzPC9zdHJvbmc+IBMgcmFyZSBidXQgc2VyaW91cyBhdCBoaWdoIGRvc2VzPC9saT4KICAgIDxsaT48c3Ryb25nPlRyb3VibGUgYnJlYXRoaW5nIG9yIHN3ZWxsaW5nIG9mIHRoZSBmYWNlL2xpcHM8L3N0cm9uZz4gEyBwb3NzaWJsZSBhbGxlcmdpYyByZWFjdGlvbjwvbGk+CiAgPC91bD4KCiAgPGJ1dHRvbiBvbmNsaWNrPSJjYWxsRW1lcmdlbmN5U3VwcG9ydCgpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZDk1MzRmO2NvbG9yOndoaXRlO3BhZGRpbmc6MC43NWVtIDEuNWVtO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6NXB4O2ZvbnQtd2VpZ2h0OmJvbGQ7Y3Vyc29yOnBvaW50ZXI7Ij4KICAgID2oIENvbnRhY3QgRW1lcmdlbmN5IFN1cHBvcnQKICA8L2J1dHRvbj4KPC9kaXY+CiAgICAgIGA7CgogICAgICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImVzIikpIHsKICAgICAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGAKPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIGVtZXJnZW5jeS1jYWxsIHByZWFkbWlzc2lvbi1sZW5zIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmM2NkO3BhZGRpbmc6MWVtO2JvcmRlcjoxcHggc29saWQgI2Y1YzJjNzttYXJnaW4tYm90dG9tOjFlbTtib3JkZXItcmFkaXVzOjVweDtmb250LWZhbWlseTpzYW5zLXNlcmlmOyI+CiAgPHN0cm9uZz6gDyBXYXJuaW5nIGZvciBwYXRpZW50cyB3aXRoIGhlYXJ0IGZhaWx1cmUgdGFraW5nIEZ1cm9zZW1pZGU8L3N0cm9uZz48YnI+PGJyPgoKICBGdXJvc2VtaWRlIGhlbHBzIHJlZHVjZSBmbHVpZCBidWlsZHVwLCBidXQgaW4gc29tZSBjYXNlcyBpdCBtYXkgY2F1c2Ugc2VyaW91cyBzaWRlIGVmZmVjdHMgdGhhdCByZXF1aXJlIGltbWVkaWF0ZSBtZWRpY2FsIGF0dGVudGlvbi4gUGxlYXNlIHN0b3AgYW5kIHNlZWsgZW1lcmdlbmN5IGNhcmUgaWYgeW91IGV4cGVyaWVuY2UgYW55IG9mIHRoZSBmb2xsb3dpbmc6CgogIDx1bCBzdHlsZT0ibWFyZ2luLXRvcDogMWVtOyBtYXJnaW4tYm90dG9tOiAxZW07Ij4KICAgIDxsaT48c3Ryb25nPlNldmVyZSBkaXp6aW5lc3Mgb3IgZmFpbnRpbmc8L3N0cm9uZz4gEyBtYXkgaW5kaWNhdGUgbG93IGJsb29kIHByZXNzdXJlIG9yIGZsdWlkIGxvc3M8L2xpPgogICAgPGxpPjxzdHJvbmc+TXVzY2xlIGNyYW1wcyBvciB3ZWFrbmVzczwvc3Ryb25nPiATIGNvdWxkIGJlIGEgc2lnbiBvZiBsb3cgcG90YXNzaXVtPC9saT4KICAgIDxsaT48c3Ryb25nPklycmVndWxhciBvciBmYXN0IGhlYXJ0YmVhdDwvc3Ryb25nPiATIG1heSBpbmRpY2F0ZSBhIHNlcmlvdXMgZWxlY3Ryb2x5dGUgaW1iYWxhbmNlPC9saT4KICAgIDxsaT48c3Ryb25nPlN1ZGRlbiBjaGVzdCBwYWluPC9zdHJvbmc+IBMgcG9zc2libGUgY2FyZGlhYyBjb21wbGljYXRpb248L2xpPgogICAgPGxpPjxzdHJvbmc+Q29uZnVzaW9uIG9yIGV4dHJlbWUgZmF0aWd1ZTwvc3Ryb25nPiATIG1heSBzaWduYWwgbG93IHNvZGl1bSBvciBkZWh5ZHJhdGlvbjwvbGk+CiAgICA8bGk+PHN0cm9uZz5IZWFyaW5nIGxvc3Mgb3IgcmluZ2luZyBpbiB0aGUgZWFyczwvc3Ryb25nPiATIHJhcmUgYnV0IHNlcmlvdXMgYXQgaGlnaCBkb3NlczwvbGk+CiAgICA8bGk+PHN0cm9uZz5Ucm91YmxlIGJyZWF0aGluZyBvciBzd2VsbGluZyBvZiB0aGUgZmFjZS9saXBzPC9zdHJvbmc+IBMgcG9zc2libGUgYWxsZXJnaWMgcmVhY3Rpb248L2xpPgogIDwvdWw+CgogIDxidXR0b24gb25jbGljaz0iY2FsbEVtZXJnZW5jeVN1cHBvcnQoKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2Q5NTM0Zjtjb2xvcjp3aGl0ZTtwYWRkaW5nOjAuNzVlbSAxLjVlbTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtmb250LXdlaWdodDpib2xkO2N1cnNvcjpwb2ludGVyOyI+CiAgICA9qCBDb250YWN0IEVtZXJnZW5jeSBTdXBwb3J0CiAgPC9idXR0b24+CjwvZGl2PgogICAgICBgOwogICAgICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImRhIikpIHsKICAgICAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGAKPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIGVtZXJnZW5jeS1jYWxsIHByZWFkbWlzc2lvbi1sZW5zIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmM2NkO3BhZGRpbmc6MWVtO2JvcmRlcjoxcHggc29saWQgI2Y1YzJjNzttYXJnaW4tYm90dG9tOjFlbTtib3JkZXItcmFkaXVzOjVweDtmb250LWZhbWlseTpzYW5zLXNlcmlmOyI+CiAgPHN0cm9uZz6gDyBXYXJuaW5nIGZvciBwYXRpZW50cyB3aXRoIGhlYXJ0IGZhaWx1cmUgdGFraW5nIEZ1cm9zZW1pZGU8L3N0cm9uZz48YnI+PGJyPgoKICBGdXJvc2VtaWRlIGhlbHBzIHJlZHVjZSBmbHVpZCBidWlsZHVwLCBidXQgaW4gc29tZSBjYXNlcyBpdCBtYXkgY2F1c2Ugc2VyaW91cyBzaWRlIGVmZmVjdHMgdGhhdCByZXF1aXJlIGltbWVkaWF0ZSBtZWRpY2FsIGF0dGVudGlvbi4gUGxlYXNlIHN0b3AgYW5kIHNlZWsgZW1lcmdlbmN5IGNhcmUgaWYgeW91IGV4cGVyaWVuY2UgYW55IG9mIHRoZSBmb2xsb3dpbmc6CgogIDx1bCBzdHlsZT0ibWFyZ2luLXRvcDogMWVtOyBtYXJnaW4tYm90dG9tOiAxZW07Ij4KICAgIDxsaT48c3Ryb25nPlNldmVyZSBkaXp6aW5lc3Mgb3IgZmFpbnRpbmc8L3N0cm9uZz4gEyBtYXkgaW5kaWNhdGUgbG93IGJsb29kIHByZXNzdXJlIG9yIGZsdWlkIGxvc3M8L2xpPgogICAgPGxpPjxzdHJvbmc+TXVzY2xlIGNyYW1wcyBvciB3ZWFrbmVzczwvc3Ryb25nPiATIGNvdWxkIGJlIGEgc2lnbiBvZiBsb3cgcG90YXNzaXVtPC9saT4KICAgIDxsaT48c3Ryb25nPklycmVndWxhciBvciBmYXN0IGhlYXJ0YmVhdDwvc3Ryb25nPiATIG1heSBpbmRpY2F0ZSBhIHNlcmlvdXMgZWxlY3Ryb2x5dGUgaW1iYWxhbmNlPC9saT4KICAgIDxsaT48c3Ryb25nPlN1ZGRlbiBjaGVzdCBwYWluPC9zdHJvbmc+IBMgcG9zc2libGUgY2FyZGlhYyBjb21wbGljYXRpb248L2xpPgogICAgPGxpPjxzdHJvbmc+Q29uZnVzaW9uIG9yIGV4dHJlbWUgZmF0aWd1ZTwvc3Ryb25nPiATIG1heSBzaWduYWwgbG93IHNvZGl1bSBvciBkZWh5ZHJhdGlvbjwvbGk+CiAgICA8bGk+PHN0cm9uZz5IZWFyaW5nIGxvc3Mgb3IgcmluZ2luZyBpbiB0aGUgZWFyczwvc3Ryb25nPiATIHJhcmUgYnV0IHNlcmlvdXMgYXQgaGlnaCBkb3NlczwvbGk+CiAgICA8bGk+PHN0cm9uZz5Ucm91YmxlIGJyZWF0aGluZyBvciBzd2VsbGluZyBvZiB0aGUgZmFjZS9saXBzPC9zdHJvbmc+IBMgcG9zc2libGUgYWxsZXJnaWMgcmVhY3Rpb248L2xpPgogIDwvdWw+CgogIDxidXR0b24gb25jbGljaz0iY2FsbEVtZXJnZW5jeVN1cHBvcnQoKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2Q5NTM0Zjtjb2xvcjp3aGl0ZTtwYWRkaW5nOjAuNzVlbSAxLjVlbTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtmb250LXdlaWdodDpib2xkO2N1cnNvcjpwb2ludGVyOyI+CiAgICA9qCBDb250YWN0IEVtZXJnZW5jeSBTdXBwb3J0CiAgPC9idXR0b24+CjwvZGl2PgogICAgICBgOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJhbm5lckRpdi5pbm5lckhUTUwgPSBgCjxkaXYgY2xhc3M9ImFsZXJ0LWJhbm5lciBlbWVyZ2VuY3ktY2FsbCBwcmVhZG1pc3Npb24tbGVucyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZjNjZDtwYWRkaW5nOjFlbTtib3JkZXI6MXB4IHNvbGlkICNmNWMyYzc7bWFyZ2luLWJvdHRvbToxZW07Ym9yZGVyLXJhZGl1czo1cHg7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjsiPgogIDxzdHJvbmc+oA8gV2FybmluZyBmb3IgcGF0aWVudHMgd2l0aCBoZWFydCBmYWlsdXJlIHRha2luZyBGdXJvc2VtaWRlPC9zdHJvbmc+PGJyPjxicj4KCiAgRnVyb3NlbWlkZSBoZWxwcyByZWR1Y2UgZmx1aWQgYnVpbGR1cCwgYnV0IGluIHNvbWUgY2FzZXMgaXQgbWF5IGNhdXNlIHNlcmlvdXMgc2lkZSBlZmZlY3RzIHRoYXQgcmVxdWlyZSBpbW1lZGlhdGUgbWVkaWNhbCBhdHRlbnRpb24uIFBsZWFzZSBzdG9wIGFuZCBzZWVrIGVtZXJnZW5jeSBjYXJlIGlmIHlvdSBleHBlcmllbmNlIGFueSBvZiB0aGUgZm9sbG93aW5nOgoKICA8dWwgc3R5bGU9Im1hcmdpbi10b3A6IDFlbTsgbWFyZ2luLWJvdHRvbTogMWVtOyI+CiAgICA8bGk+PHN0cm9uZz5TZXZlcmUgZGl6emluZXNzIG9yIGZhaW50aW5nPC9zdHJvbmc+IBMgbWF5IGluZGljYXRlIGxvdyBibG9vZCBwcmVzc3VyZSBvciBmbHVpZCBsb3NzPC9saT4KICAgIDxsaT48c3Ryb25nPk11c2NsZSBjcmFtcHMgb3Igd2Vha25lc3M8L3N0cm9uZz4gEyBjb3VsZCBiZSBhIHNpZ24gb2YgbG93IHBvdGFzc2l1bTwvbGk+CiAgICA8bGk+PHN0cm9uZz5JcnJlZ3VsYXIgb3IgZmFzdCBoZWFydGJlYXQ8L3N0cm9uZz4gEyBtYXkgaW5kaWNhdGUgYSBzZXJpb3VzIGVsZWN0cm9seXRlIGltYmFsYW5jZTwvbGk+CiAgICA8bGk+PHN0cm9uZz5TdWRkZW4gY2hlc3QgcGFpbjwvc3Ryb25nPiATIHBvc3NpYmxlIGNhcmRpYWMgY29tcGxpY2F0aW9uPC9saT4KICAgIDxsaT48c3Ryb25nPkNvbmZ1c2lvbiBvciBleHRyZW1lIGZhdGlndWU8L3N0cm9uZz4gEyBtYXkgc2lnbmFsIGxvdyBzb2RpdW0gb3IgZGVoeWRyYXRpb248L2xpPgogICAgPGxpPjxzdHJvbmc+SGVhcmluZyBsb3NzIG9yIHJpbmdpbmcgaW4gdGhlIGVhcnM8L3N0cm9uZz4gEyByYXJlIGJ1dCBzZXJpb3VzIGF0IGhpZ2ggZG9zZXM8L2xpPgogICAgPGxpPjxzdHJvbmc+VHJvdWJsZSBicmVhdGhpbmcgb3Igc3dlbGxpbmcgb2YgdGhlIGZhY2UvbGlwczwvc3Ryb25nPiATIHBvc3NpYmxlIGFsbGVyZ2ljIHJlYWN0aW9uPC9saT4KICA8L3VsPgoKICA8YnV0dG9uIG9uY2xpY2s9ImNhbGxFbWVyZ2VuY3lTdXBwb3J0KCkiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNkOTUzNGY7Y29sb3I6d2hpdGU7cGFkZGluZzowLjc1ZW0gMS41ZW07Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo1cHg7Zm9udC13ZWlnaHQ6Ym9sZDtjdXJzb3I6cG9pbnRlcjsiPgogICAgPaggQ29udGFjdCBFbWVyZ2VuY3kgU3VwcG9ydAogIDwvYnV0dG9uPgo8L2Rpdj4KICAgICAgYDsKCiAgICAgICAgfQoKICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpOwogICAgICAgIGlmIChib2R5KSB7CiAgICAgICAgICAgIGJvZHkuaW5zZXJ0QmVmb3JlKGJhbm5lckRpdiwgYm9keS5maXJzdENoaWxkKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gBSBBZGQgdGhlIGVtZXJnZW5jeSBzY3JpcHQgb25jZSwgb25seSBpZiBub3QgYWxyZWFkeSBwcmVzZW50CiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjYWxsLWVtZXJnZW5jeS1zY3JpcHQiKSkgewogICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHNjcmlwdC5pZCA9ICJjYWxsLWVtZXJnZW5jeS1zY3JpcHQiOwogICAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgICAgc2NyaXB0LnRleHRDb250ZW50ID0gYAogICAgICBmdW5jdGlvbiBjYWxsRW1lcmdlbmN5U3VwcG9ydCgpIHsKICAgICAgICBmZXRjaCgiaHR0cHM6Ly95b3VyLWFwaS5leGFtcGxlLmNvbS9lbWVyZ2VuY3kiLCB7CiAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIgogICAgICAgICAgfSwKICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgcGF0aWVudElkOiAiMTIzNDU2IiwKICAgICAgICAgICAgZHJ1ZzogIkZ1cm9zZW1pZGUiLAogICAgICAgICAgICBjb25kaXRpb246ICJIZWFydCBGYWlsdXJlIiwKICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgIHJlYXNvbjogIkVtZXJnZW5jeSByZWFjdGlvbiByZXBvcnRlZCB2aWEgZVBJIGFsZXJ0IgogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5vaykgewogICAgICAgICAgICBhbGVydCgiRW1lcmdlbmN5IHN1cHBvcnQgaGFzIGJlZW4gbm90aWZpZWQuIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGVydCgiQ291bGQgbm90IGNvbnRhY3Qgc3VwcG9ydC4gUGxlYXNlIGNhbGwgZW1lcmdlbmN5IHNlcnZpY2VzIGRpcmVjdGx5LiIpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIGFsZXJ0KCJOZXR3b3JrIGVycm9yLiBQbGVhc2UgY2FsbCBlbWVyZ2VuY3kgc2VydmljZXMgZGlyZWN0bHkuIik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIGA7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfQoKCiAgICAvLyBDbGVhbiBoZWFkIChzYW1lIGFzIHlvdXIgb3JpZ2luYWwgbG9naWMpCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgIH0KCiAgICAvLyBFeHRyYWN0IEhUTUwgcmVzdWx0CiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsKICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uc2U6ICIgKyByZXNwb25zZSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwpOwogICAgICAgIHJlc3BvbnNlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTDsKICAgIH0KCiAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnRyaW0oKSA9PT0gIiIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFubm90YXRpb24gcHJvY2VzcyBmYWlsZWQ6IGVtcHR5IG9yIG51bGwgcmVzcG9uc2UiKTsKICAgIH0KCiAgICByZXR1cm4gcmVzcG9uc2U7Cn07CgpsZXQgZW5oYW5jZSA9IGFzeW5jICgpID0+IHsKCiAgICBpZiAoIWVwaURhdGEgfHwgIWVwaURhdGEuZW50cnkgfHwgZXBpRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImVQSSBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQogICAgbGV0IGxpc3RPZkNhdGVnb3JpZXNUb1NlYXJjaCA9IFt7ICJjb2RlIjogImdyYXYtNSIsICJzeXN0ZW0iOiAiaHR0cHM6Ly93d3cuZ3Jhdml0YXRlaGVhbHRoLmV1L3NpZC9kb2MiIH1dOyAvL3doYXQgdG8gbG9vayBpbiBleHRlbnNpb25zIC1tYWRlIHVwIGNvZGUgYmVjYXVzZSB0aGVyZSBpcyBub25lCgogICAgLy8gTWF0Y2ggbGlzdHMKICAgIGNvbnN0IEJVTkRMRV9JREVOVElGSUVSX0xJU1QgPSBbImVwaWJ1bmRsZS0xMjMiLCAiZXBpYnVuZGxlLWFiYyJdOwogICAgY29uc3QgUFJPRFVDVF9JREVOVElGSUVSX0xJU1QgPSBbIkNJVC0yMDQ0NDciLCAiUklTLTE5NzM2MSJdOwoKCiAgICBsZXQgbWF0Y2hGb3VuZCA9IGZhbHNlOwogICAgbGV0IGxhbmd1YWdlRGV0ZWN0ZWQgPSBudWxsOwoKICAgIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlCiAgICBlcGlEYXRhLmVudHJ5Py5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIkNvbXBvc2l0aW9uIiAmJiByZXMubGFuZ3VhZ2UpIHsKICAgICAgICAgICAgbGFuZ3VhZ2VEZXRlY3RlZCA9IHJlcy5sYW5ndWFnZTsKICAgICAgICAgICAgY29uc29sZS5sb2coIjwNIERldGVjdGVkIGZyb20gQ29tcG9zaXRpb24ubGFuZ3VhZ2U6IiwgbGFuZ3VhZ2VEZXRlY3RlZCk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gMi4gSWYgbm90IGZvdW5kLCBjaGVjayBCdW5kbGUubGFuZ3VhZ2UKICAgIGlmICghbGFuZ3VhZ2VEZXRlY3RlZCAmJiBlcGlEYXRhLmxhbmd1YWdlKSB7CiAgICAgICAgbGFuZ3VhZ2VEZXRlY3RlZCA9IGVwaURhdGEubGFuZ3VhZ2U7CiAgICAgICAgY29uc29sZS5sb2coIjwNIERldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmd1YWdlRGV0ZWN0ZWQpOwogICAgfQoKICAgIC8vIDMuIEZhbGxiYWNrIG1lc3NhZ2UKICAgIGlmICghbGFuZ3VhZ2VEZXRlY3RlZCkgewogICAgICAgIGNvbnNvbGUud2FybigioA8gTm8gbGFuZ3VhZ2UgZGV0ZWN0ZWQgaW4gQ29tcG9zaXRpb24gb3IgQnVuZGxlLiIpOwogICAgfQoKICAgIC8vIENoZWNrIGJ1bmRsZS5pZGVudGlmaWVyLnZhbHVlCiAgICBpZiAoCiAgICAgICAgZXBpRGF0YS5pZGVudGlmaWVyICYmCiAgICAgICAgQlVORExFX0lERU5USUZJRVJfTElTVC5pbmNsdWRlcyhlcGlEYXRhLmlkZW50aWZpZXIudmFsdWUpCiAgICApIHsKICAgICAgICBjb25zb2xlLmxvZygiPRcgTWF0Y2hlZCBlUEkgQnVuZGxlLmlkZW50aWZpZXI6IiwgZXBpRGF0YS5pZGVudGlmaWVyLnZhbHVlKTsKICAgICAgICBtYXRjaEZvdW5kID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBDaGVjayBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyLnZhbHVlCiAgICBlcGlEYXRhLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7CiAgICAgICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24iKSB7CiAgICAgICAgICAgIGNvbnN0IGlkcyA9IHJlcy5pZGVudGlmaWVyIHx8IFtdOwogICAgICAgICAgICBpZHMuZm9yRWFjaCgoaWQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChQUk9EVUNUX0lERU5USUZJRVJfTElTVC5pbmNsdWRlcyhpZC52YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiPYogTWF0Y2hlZCBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyOiIsIGlkLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaEZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gZVBJIHRyYXNsYXRpb24gZnJvbSB0ZXJtaW5vbG9neSBjb2RlcyB0byB0aGVpciBodW1hbiByZWRhYmxlIHRyYW5zbGF0aW9ucyBpbiB0aGUgc2VjdGlvbnMKICAgIC8vIGluIHRoaXMgY2FzZSwgaWYgaXMgZG9lcyBub3QgZmluZCBhIHBsYWNlLCBhZGRzIGl0IHRvIHRoZSB0b3Agb2YgdGhlIGVQSQogICAgbGV0IGNvbXBvc2l0aW9ucyA9IDA7CiAgICBsZXQgY2F0ZWdvcmllcyA9IFtdOwogICAgZXBpLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgaWYgKGVudHJ5LnJlc291cmNlLnJlc291cmNlVHlwZSA9PSAiQ29tcG9zaXRpb24iKSB7CiAgICAgICAgICAgIGNvbXBvc2l0aW9ucysrOwogICAgICAgICAgICAvL0l0ZXJhdGVkIHRocm91Z2ggdGhlIENvbmRpdGlvbiBlbGVtZW50IHNlYXJjaGluZyBmb3IgY29uZGl0aW9ucwogICAgICAgICAgICBlbnRyeS5yZXNvdXJjZS5leHRlbnNpb24uZm9yRWFjaCgoZWxlbWVudCkgPT4gewoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBwb3NpdGlvbiBvZiB0aGUgZXh0ZW5zaW9uWzFdIGlzIGNvcnJlY3QKICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS51cmwgPT0gImNvbmNlcHQiKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2VhcmNoIHRocm91Z2ggdGhlIGRpZmZlcmVudCB0ZXJtaW5vbG9naWVzIHRoYXQgbWF5IGJlIGF2YWlibGUgdG8gY2hlY2sgaW4gdGhlIGNvbmRpdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdC5jb2RpbmcuZm9yRWFjaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb2RpbmcpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uOiAiICsgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcgKyAiOiIgKyBjb2RpbmcuY29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY29kZSBpcyBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzIHRvIHNlYXJjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2guc29tZShpdGVtID0+IGl0ZW0uY29kZSA9PT0gY29kaW5nLmNvZGUgJiYgaXRlbS5zeXN0ZW0gPT09IGNvZGluZy5zeXN0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJGb3VuZCIsIGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2F0ZWdvcnkgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMucHVzaChlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoY29tcG9zaXRpb25zID09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBlUEk6IG5vIGNhdGVnb3J5ICJDb21wb3NpdGlvbiIgZm91bmQnKTsKICAgIH0KCiAgICBpZiAoIW1hdGNoRm91bmQpIHsKICAgICAgICBjb25zb2xlLmxvZygiZVBJIGlzIG5vdCBmb3IgYSBoaWdoLXJpc2sgc2lkZSBlZmZlY3QgbWVkaWNhdGlvbiIpOwogICAgICAgIHJldHVybiBodG1sRGF0YTsKICAgIH0KCiAgICBlbHNlIHsKCgogICAgICAgIGxldCByZXNwb25zZSA9IGh0bWxEYXRhOwogICAgICAgIGxldCBkb2N1bWVudDsKCiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsKICAgICAgICAgICAgbGV0IHsgSlNET00gfSA9IGpzZG9tOwogICAgICAgICAgICBsZXQgZG9tID0gbmV3IEpTRE9NKGh0bWxEYXRhKTsKICAgICAgICAgICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50OwogICAgICAgICAgICByZXR1cm4gaW5zZXJ0UXVlc3Rpb25uYWlyZUxpbmsoY2F0ZWdvcmllcywgbGFuZ3VhZ2VEZXRlY3RlZCwgZG9jdW1lbnQsIHJlc3BvbnNlKTsKICAgICAgICAgICAgLy9saXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKICAgICAgICAgICAgcmV0dXJuIGluc2VydFF1ZXN0aW9ubmFpcmVMaW5rKGNhdGVnb3JpZXMsIGxhbmd1YWdlRGV0ZWN0ZWQsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgICAgICAgfQogICAgfTsKfTsKCnJldHVybiB7CiAgICBlbmhhbmNlOiBlbmhhbmNlLAogICAgZ2V0U3BlY2lmaWNhdGlvbjogZ2V0U3BlY2lmaWNhdGlvbiwKfTsK"
    }
  ]
}