{
  "resourceType": "Library",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "https://gravitate-health.lst.tfo.upm.es/ips/api/fhir/Library/592",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "preadmission-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Serious Symptoms Checker Lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacción"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "date": "2026-02-06T06:43:34.043Z",
  "title": "preadmission Lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacción"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "A lens that highlight any information related to interactions between other mediciones or ePIs",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Una lente que resalta cualquier información relacionada con interacciones entre otros medicamentos o ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Uma lente que destaca qualquer informação relacionada com interações entre outros medicamentos ou ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "En linse, der fremhæver al information relateret til interaktioner mellem andre lægemidler eller ePI'er."
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Clarify the important things related to interactions between other ePIs in the ePI provided",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Aclarar los aspectos importantes relacionados con interacciones entre otros ePIs en el ePI proporcionado."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esclarecer os pontos importantes relacionados com interações entre outros ePIs no ePI fornecido."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Klargør de vigtige ting vedrørende interaktioner mellem andre ePI'er i den angivne ePI."
          }
        ]
      }
    ]
  },
  "usage": "This lens requires a preprocessed ePI, and an IPS to work. You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Esta lente requiere una ePI preprocesada y un IPS para funcionar. Puedes importar esta lente directamente en tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esta lente requer uma ePI pré-processada e um IPS para funcionar. Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Denne linse kræver en forbehandlet ePI og en IPS for at fungere. Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwpsZXQgbGFuZyA9ICIiOwoKLy8gRnVuY3Rpb24gdG8gZ2V0IHRoZSBsZW5zIHNwZWNpZmljYXRpb24KbGV0IGdldFNwZWNpZmljYXRpb24gPSAoKSA9PiB7CiAgICByZXR1cm4gIjEuMC4wLXByZWFkbWlzc2lvbi1iYW5uZXIiOwp9OwoKLy8gRnVuY3Rpb24gdG8gZ2V0IHRoZSBleHBsYW5hdGlvbiBvZiB0aGUgbGVucwpjb25zdCBnZXRFeHBsYW5hdGlvbiA9IChsYW5nID0gImVuIikgPT4gewogICAgY29uc3QgZXhwbGFuYXRpb25zID0gewogICAgICAgIGVuOiAiVGhpcyBsZW5zIGFkZHMgYSB3YXJuaW5nIGJhbm5lciBmb3IgcGF0aWVudHMgd2l0aCBoZWFydCBmYWlsdXJlIHRha2luZyBGdXJvc2VtaWRlLCBhbmQgcHJvdmlkZXMgYSBsaW5rIHRvIGEgc2FmZXR5IHF1ZXN0aW9ubmFpcmUuIiwKICAgICAgICBwdDogIkVzdGEgbGVudGUgYWRpY2lvbmEgdW0gYmFubmVyIGRlIGF2aXNvIHBhcmEgcGFjaWVudGVzIGNvbSBpbnN1ZmljacOqbmNpYSBjYXJkw61hY2EgcXVlIHRvbWFtIEZ1cm9zZW1pZGEgZSBmb3JuZWNlIHVtIGxpbmsgcGFyYSB1bSBxdWVzdGlvbsOhcmlvIGRlIHNlZ3VyYW7Dp2EuIiwKICAgICAgICBlczogIkVzdGEgbGVudGUgYWdyZWdhIHVuIGJhbm5lciBkZSBhZHZlcnRlbmNpYSBwYXJhIHBhY2llbnRlcyBjb24gaW5zdWZpY2llbmNpYSBjYXJkw61hY2EgcXVlIHRvbWFuIEZ1cm9zZW1pZGEgeSBwcm9wb3JjaW9uYSB1biBlbmxhY2UgYSB1biBjdWVzdGlvbmFyaW8gZGUgc2VndXJpZGFkLiIsCiAgICAgICAgZGE6ICJEZW5uZSBsaW5zZSB0aWxmw7hqZXIgZW4gYWR2YXJzZWxzYmFubmVyIGZvciBwYXRpZW50ZXIgbWVkIGhqZXJ0ZXN2aWd0LCBkZXIgdGFnZXIgRnVyb3NlbWlkLCBvZyBnaXZlciBldCBsaW5rIHRpbCBldCBzaWtrZXJoZWRzc3DDuHJnZXNrZW1hLiIsCiAgICB9OwogICAgcmV0dXJuIGV4cGxhbmF0aW9uc1tsYW5nXSB8fCBleHBsYW5hdGlvbnMuZW47Cn07CgovLyBGdW5jdGlvbiB0byBnZXQgdGhlIHJlcG9ydCBvZiB0aGUgbGVucwpjb25zdCBnZXRSZXBvcnQgPSAobGFuZyA9ICJlbiIpID0+IHsKICAgIHJldHVybiB7CiAgICAgICAgbWVzc2FnZTogZ2V0RXhwbGFuYXRpb24obGFuZyksCiAgICAgICAgc3RhdHVzOiAic3VjY2VzcyIsIC8vIG9yICJlcnJvciIgb3IgIndhcm5pbmciCiAgICB9Owp9OwoKLy8gRGV0ZWN0IGxhbmd1YWdlIGZyb20gZVBJCmNvbnN0IGRldGVjdExhbmd1YWdlID0gKCkgPT4gewogICAgZXBpRGF0YS5lbnRyeT8uZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICBjb25zdCByZXMgPSBlbnRyeS5yZXNvdXJjZTsKICAgICAgICBpZiAocmVzPy5yZXNvdXJjZVR5cGUgPT09ICJDb21wb3NpdGlvbiIgJiYgcmVzLmxhbmd1YWdlKSB7CiAgICAgICAgICAgIGxhbmcgPSByZXMubGFuZ3VhZ2U7CiAgICAgICAgfQogICAgfSk7CgogICAgaWYgKCFsYW5nICYmIGVwaURhdGEubGFuZ3VhZ2UpIHsKICAgICAgICBsYW5nID0gZXBpRGF0YS5sYW5ndWFnZTsKICAgIH0KCiAgICBpZiAoIWxhbmcpIHsKICAgICAgICBsYW5nID0gImVuIjsKICAgIH0KfTsKCmNvbnN0IGdldEJhbm5lckhUTUwgPSAobGFuZ3VhZ2UpID0+IHsKICAgIGNvbnN0IGJhbm5lcnMgPSB7CiAgICAgICAgZW46IGAKPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIGVtZXJnZW5jeS1jYWxsIHByZWFkbWlzc2lvbi1sZW5zIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmM2NkO3BhZGRpbmc6MWVtO2JvcmRlcjoxcHggc29saWQgI2Y1YzJjNzttYXJnaW4tYm90dG9tOjFlbTtib3JkZXItcmFkaXVzOjVweDtmb250LWZhbWlseTpzYW5zLXNlcmlmOyI+CiAgPHN0cm9uZz7imqDvuI8gV2FybmluZyBmb3IgcGF0aWVudHMgd2l0aCBoZWFydCBmYWlsdXJlIHRha2luZyBGdXJvc2VtaWRlPC9zdHJvbmc+PGJyPjxicj4KICBGdXJvc2VtaWRlIGhlbHBzIHJlZHVjZSBmbHVpZCBidWlsZHVwLCBidXQgaW4gc29tZSBjYXNlcyBpdCBtYXkgY2F1c2Ugc2VyaW91cyBzaWRlIGVmZmVjdHMgdGhhdCByZXF1aXJlIGltbWVkaWF0ZSBtZWRpY2FsIGF0dGVudGlvbi4gUGxlYXNlIHN0b3AgYW5kIHNlZWsgZW1lcmdlbmN5IGNhcmUgaWYgeW91IGV4cGVyaWVuY2UgYW55IG9mIHRoZSBmb2xsb3dpbmc6CiAgPHVsIHN0eWxlPSJtYXJnaW4tdG9wOiAxZW07IG1hcmdpbi1ib3R0b206IDFlbTsiPgogICAgPGxpPjxzdHJvbmc+U2V2ZXJlIGRpenppbmVzcyBvciBmYWludGluZzwvc3Ryb25nPiDigJMgbWF5IGluZGljYXRlIGxvdyBibG9vZCBwcmVzc3VyZSBvciBmbHVpZCBsb3NzPC9saT4KICAgIDxsaT48c3Ryb25nPk11c2NsZSBjcmFtcHMgb3Igd2Vha25lc3M8L3N0cm9uZz4g4oCTIGNvdWxkIGJlIGEgc2lnbiBvZiBsb3cgcG90YXNzaXVtPC9saT4KICAgIDxsaT48c3Ryb25nPklycmVndWxhciBvciBmYXN0IGhlYXJ0YmVhdDwvc3Ryb25nPiDigJMgbWF5IGluZGljYXRlIGEgc2VyaW91cyBlbGVjdHJvbHl0ZSBpbWJhbGFuY2U8L2xpPgogICAgPGxpPjxzdHJvbmc+U3VkZGVuIGNoZXN0IHBhaW48L3N0cm9uZz4g4oCTIHBvc3NpYmxlIGNhcmRpYWMgY29tcGxpY2F0aW9uPC9saT4KICAgIDxsaT48c3Ryb25nPkNvbmZ1c2lvbiBvciBleHRyZW1lIGZhdGlndWU8L3N0cm9uZz4g4oCTIG1heSBzaWduYWwgbG93IHNvZGl1bSBvciBkZWh5ZHJhdGlvbjwvbGk+CiAgICA8bGk+PHN0cm9uZz5IZWFyaW5nIGxvc3Mgb3IgcmluZ2luZyBpbiB0aGUgZWFyczwvc3Ryb25nPiDigJMgcmFyZSBidXQgc2VyaW91cyBhdCBoaWdoIGRvc2VzPC9saT4KICAgIDxsaT48c3Ryb25nPlRyb3VibGUgYnJlYXRoaW5nIG9yIHN3ZWxsaW5nIG9mIHRoZSBmYWNlL2xpcHM8L3N0cm9uZz4g4oCTIHBvc3NpYmxlIGFsbGVyZ2ljIHJlYWN0aW9uPC9saT4KICA8L3VsPgogIDxidXR0b24gb25jbGljaz0iY2FsbEVtZXJnZW5jeVN1cHBvcnQoKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2Q5NTM0Zjtjb2xvcjp3aGl0ZTtwYWRkaW5nOjAuNzVlbSAxLjVlbTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtmb250LXdlaWdodDpib2xkO2N1cnNvcjpwb2ludGVyOyI+CiAgICDwn5qoIENvbnRhY3QgRW1lcmdlbmN5IFN1cHBvcnQKICA8L2J1dHRvbj4KPC9kaXY+YCwKICAgICAgICBwdDogYAo8ZGl2IGNsYXNzPSJhbGVydC1iYW5uZXIgZW1lcmdlbmN5LWNhbGwgcHJlYWRtaXNzaW9uLWxlbnMiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmYzY2Q7cGFkZGluZzoxZW07Ym9yZGVyOjFweCBzb2xpZCAjZjVjMmM3O21hcmdpbi1ib3R0b206MWVtO2JvcmRlci1yYWRpdXM6NXB4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Ij4KICA8c3Ryb25nPuKaoO+4jyBBdmlzbyBwYXJhIHBhY2llbnRlcyBjb20gaW5zdWZpY2nDqm5jaWEgY2FyZMOtYWNhIGEgdG9tYXIgRnVyb3NlbWlkYTwvc3Ryb25nPjxicj48YnI+CiAgQSBmdXJvc2VtaWRhIGFqdWRhIGEgcmVkdXppciBhIGFjdW11bGHDp8OjbyBkZSBmbHVpZG9zLCBtYXMgZW0gYWxndW5zIGNhc29zIHBvZGUgY2F1c2FyIGVmZWl0b3Mgc2VjdW5kw6FyaW9zIGdyYXZlcyBxdWUgcmVxdWVyZW0gYXRlbsOnw6NvIG3DqWRpY2EgaW1lZGlhdGEuIFBhcmUgZGUgdG9tYXIgZSBwcm9jdXJlIGF0ZW5kaW1lbnRvIGRlIGVtZXJnw6puY2lhIHNlIHNlbnRpciBhbGd1bSBkb3Mgc2VndWludGVzOgogIDx1bCBzdHlsZT0ibWFyZ2luLXRvcDogMWVtOyBtYXJnaW4tYm90dG9tOiAxZW07Ij4KICAgIDxsaT48c3Ryb25nPlRvbnR1cmFzIGdyYXZlcyBvdSBkZXNtYWlvczwvc3Ryb25nPiDigJMgcG9kZSBpbmRpY2FyIHByZXNzw6NvIGFydGVyaWFsIGJhaXhhIG91IHBlcmRhIGRlIGZsdWlkb3M8L2xpPgogICAgPGxpPjxzdHJvbmc+Q8OjaWJyYXMgbXVzY3VsYXJlcyBvdSBmcmFxdWV6YTwvc3Ryb25nPiDigJMgcG9kZSBzZXIgdW0gc2luYWwgZGUgYmFpeG8gdGVvciBkZSBwb3TDoXNzaW88L2xpPgogICAgPGxpPjxzdHJvbmc+QmF0aW1lbnRvIGNhcmTDrWFjbyBpcnJlZ3VsYXIgb3UgcsOhcGlkbzwvc3Ryb25nPiDigJMgcG9kZSBpbmRpY2FyIHVtIGRlc2VxdWlsw61icmlvIGVsZXRyb2zDrXRpY28gZ3JhdmU8L2xpPgogICAgPGxpPjxzdHJvbmc+RG9yIHPDumJpdGEgbm8gcGVpdG88L3N0cm9uZz4g4oCTIHBvc3PDrXZlbCBjb21wbGljYcOnw6NvIGNhcmTDrWFjYTwvbGk+CiAgICA8bGk+PHN0cm9uZz5Db25mdXPDo28gb3UgZmFkaWdhIGV4dHJlbWE8L3N0cm9uZz4g4oCTIHBvZGUgc2luYWxpemFyIGJhaXhvIHRlb3IgZGUgc8OzZGlvIG91IGRlc2lkcmF0YcOnw6NvPC9saT4KICAgIDxsaT48c3Ryb25nPlBlcmRhIGRlIGF1ZGnDp8OjbyBvdSB6dW1iaWRvIG5vcyBvdXZpZG9zPC9zdHJvbmc+IOKAkyByYXJvIG1hcyBncmF2ZSBlbSBkb3NlcyBlbGV2YWRhczwvbGk+CiAgICA8bGk+PHN0cm9uZz5EaWZpY3VsZGFkZSBlbSByZXNwaXJhciBvdSBpbmNoYcOnbyBkbyByb3N0by9sw6FiaW9zPC9zdHJvbmc+IOKAkyBwb3Nzw612ZWwgcmVhw6fDo28gYWzDqXJnaWNhPC9saT4KICA8L3VsPgogIDxidXR0b24gb25jbGljaz0iY2FsbEVtZXJnZW5jeVN1cHBvcnQoKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2Q5NTM0Zjtjb2xvcjp3aGl0ZTtwYWRkaW5nOjAuNzVlbSAxLjVlbTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtmb250LXdlaWdodDpib2xkO2N1cnNvcjpwb2ludGVyOyI+CiAgICDwn5qoIENvbnRhY3RhciBvIFN1cG9ydGUgZGUgRW1lcmfDqm5jaWEKICA8L2J1dHRvbj4KPC9kaXY+YCwKICAgICAgICBlczogYAo8ZGl2IGNsYXNzPSJhbGVydC1iYW5uZXIgZW1lcmdlbmN5LWNhbGwgcHJlYWRtaXNzaW9uLWxlbnMiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmYzY2Q7cGFkZGluZzoxZW07Ym9yZGVyOjFweCBzb2xpZCAjZjVjMmM3O21hcmdpbi1ib3R0b206MWVtO2JvcmRlci1yYWRpdXM6NXB4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Ij4KICA8c3Ryb25nPuKaoO+4jyBBZHZlcnRlbmNpYSBwYXJhIHBhY2llbnRlcyBjb24gaW5zdWZpY2llbmNpYSBjYXJkw61hY2EgcXVlIHRvbWFuIEZ1cm9zZW1pZGE8L3N0cm9uZz48YnI+PGJyPgogIExhIGZ1cm9zZW1pZGEgYXl1ZGEgYSByZWR1Y2lyIGxhIGFjdW11bGFjacOzbiBkZSBsw61xdWlkb3MsIHBlcm8gZW4gYWxndW5vcyBjYXNvcyBwdWVkZSBjYXVzYXIgZWZlY3RvcyBzZWN1bmRhcmlvcyBncmF2ZXMgcXVlIHJlcXVpZXJlbiBhdGVuY2nDs24gbcOpZGljYSBpbm1lZGlhdGEuIERlamUgZGUgdG9tYXJsYSB5IGJ1c3F1ZSBhdGVuY2nDs24gZGUgZW1lcmdlbmNpYSBzaSBleHBlcmltZW50YSBhbGd1bm8gZGUgbG9zIHNpZ3VpZW50ZXM6CiAgPHVsIHN0eWxlPSJtYXJnaW4tdG9wOiAxZW07IG1hcmdpbi1ib3R0b206IDFlbTsiPgogICAgPGxpPjxzdHJvbmc+TWFyZW9zIGludGVuc29zIG8gZGVzbWF5b3M8L3N0cm9uZz4g4oCTIHB1ZWRlIGluZGljYXIgcHJlc2nDs24gYXJ0ZXJpYWwgYmFqYSBvIHDDqXJkaWRhIGRlIGzDrXF1aWRvczwvbGk+CiAgICA8bGk+PHN0cm9uZz5DYWxhbWJyZXMgbyBkZWJpbGlkYWQgbXVzY3VsYXI8L3N0cm9uZz4g4oCTIHBvZHLDrWEgc2VyIHVuIHNpZ25vIGRlIGJham8gbml2ZWwgZGUgcG90YXNpbzwvbGk+CiAgICA8bGk+PHN0cm9uZz5MYXRpZG9zIGNhcmTDrWFjb3MgaXJyZWd1bGFyZXMgbyByw6FwaWRvczwvc3Ryb25nPiDigJMgcHVlZGUgaW5kaWNhciB1biBkZXNlcXVpbGlicmlvIGVsZWN0cm9sw610aWNvIGdyYXZlPC9saT4KICAgIDxsaT48c3Ryb25nPkRvbG9yIHRvcsOhY2ljbyByZXBlbnRpbm88L3N0cm9uZz4g4oCTIHBvc2libGUgY29tcGxpY2FjacOzbiBjYXJkw61hY2E8L2xpPgogICAgPGxpPjxzdHJvbmc+Q29uZnVzacOzbiBvIGZhdGlnYSBleHRyZW1hPC9zdHJvbmc+IOKAkyBwdWVkZSBpbmRpY2FyIHVuIG5pdmVsIGJham8gZGUgc29kaW8gbyBkZXNoaWRyYXRhY2nDs248L2xpPgogICAgPGxpPjxzdHJvbmc+UMOpcmRpZGEgZGUgYXVkaWNpw7NuIG8genVtYmlkbyBlbiBsb3Mgb8OtZG9zPC9zdHJvbmc+IOKAkyByYXJvIHBlcm8gZ3JhdmUgZW4gZG9zaXMgYWx0YXM8L2xpPgogICAgPGxpPjxzdHJvbmc+RGlmaWN1bHRhZCBwYXJhIHJlc3BpcmFyIG8gaGluY2hhesOzbiBkZSBsYSBjYXJhL2xhYmlvczwvc3Ryb25nPiDigJMgcG9zaWJsZSByZWFjY2nDs24gYWzDqXJnaWNhPC9saT4KICA8L3VsPgogIDxidXR0b24gb25jbGljaz0iY2FsbEVtZXJnZW5jeVN1cHBvcnQoKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2Q5NTM0Zjtjb2xvcjp3aGl0ZTtwYWRkaW5nOjAuNzVlbSAxLjVlbTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtmb250LXdlaWdodDpib2xkO2N1cnNvcjpwb2ludGVyOyI+CiAgICDwn5qoIENvbnRhY3RhciBjb24gZWwgU29wb3J0ZSBkZSBFbWVyZ2VuY2lhCiAgPC9idXR0b24+CjwvZGl2PmAsCiAgICAgICAgZGE6IGAKPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIGVtZXJnZW5jeS1jYWxsIHByZWFkbWlzc2lvbi1sZW5zIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmM2NkO3BhZGRpbmc6MWVtO2JvcmRlcjoxcHggc29saWQgI2Y1YzJjNzttYXJnaW4tYm90dG9tOjFlbTtib3JkZXItcmFkaXVzOjVweDtmb250LWZhbWlseTpzYW5zLXNlcmlmOyI+CiAgPHN0cm9uZz7imqDvuI8gQWR2YXJzZWwgdGlsIHBhdGllbnRlciBtZWQgaGplcnRlc3ZpZ3QsIGRlciB0YWdlciBGdXJvc2VtaWQ8L3N0cm9uZz48YnI+PGJyPgogIEZ1cm9zZW1pZCBoasOmbHBlciBtZWQgYXQgcmVkdWNlcmUgdsOmc2tlb3Bob2JuaW5nLCBtZW4gaSBub2dsZSB0aWxmw6ZsZGUga2FuIGRldCBmb3LDpXJzYWdlIGFsdm9ybGlnZSBiaXZpcmtuaW5nZXIsIGRlciBrcsOmdmVyIMO4amVibGlra2VsaWcgbMOmZ2VoasOmbHAuIFN0b3AgbWVkIGF0IHRhZ2UgbWVkaWNpbmVuIG9nIHPDuGcgYWt1dCBsw6ZnZWhqw6ZscCwgaHZpcyBkdSBvcGxldmVyIG5vZ2V0IGFmIGbDuGxnZW5kZToKICA8dWwgc3R5bGU9Im1hcmdpbi10b3A6IDFlbTsgbWFyZ2luLWJvdHRvbTogMWVtOyI+CiAgICA8bGk+PHN0cm9uZz5BbHZvcmxpZyBzdmltbWVsaGVkIGVsbGVyIGJlc3ZpbWVsc2U8L3N0cm9uZz4g4oCTIGthbiBpbmRpa2VyZSBsYXZ0IGJsb2R0cnlrIGVsbGVyIHbDpnNrZXRhYjwvbGk+CiAgICA8bGk+PHN0cm9uZz5NdXNrZWxrcmFtcGVyIGVsbGVyIC1zdmFnaGVkPC9zdHJvbmc+IOKAkyBrYW4gdsOmcmUgZXQgdGVnbiBww6UgbGF2dCBrYWxpdW08L2xpPgogICAgPGxpPjxzdHJvbmc+VXJlZ2VsbcOmc3NpZyBlbGxlciBodXJ0aWcgaGplcnRlcnl0bWU8L3N0cm9uZz4g4oCTIGthbiBpbmRpa2VyZSBlbiBhbHZvcmxpZyBlbGVrdHJvbHl0Zm9yc3R5cnJlbHNlPC9saT4KICAgIDxsaT48c3Ryb25nPlBsdWRzZWxpZyBicnlzdHNtZXJ0ZXI8L3N0cm9uZz4g4oCTIG11bGlnIGhqZXJ0ZWtvbXBsaWthdGlvbjwvbGk+CiAgICA8bGk+PHN0cm9uZz5Gb3J2aXJyaW5nIGVsbGVyIGVrc3RyZW0gdHLDpnRoZWQ8L3N0cm9uZz4g4oCTIGthbiBzaWduYWxlcmUgbGF2dCBuYXRyaXVtIGVsbGVyIGRlaHlkcmVyaW5nPC9saT4KICAgIDxsaT48c3Ryb25nPkjDuHJldGFiIGVsbGVyIHJpbmdlbiBmb3Igw7hyZXJuZTwvc3Ryb25nPiDigJMgc2rDpmxkZW4sIG1lbiBhbHZvcmxpZyB2ZWQgaMO4amUgZG9zZXI8L2xpPgogICAgPGxpPjxzdHJvbmc+VmVqcnRyw6ZrbmluZ3NiZXN2w6ZyIGVsbGVyIGjDpnZlbHNlIGFmIGFuc2lndC9sw6ZiZXI8L3N0cm9uZz4g4oCTIG11bGlnIGFsbGVyZ2lzayByZWFrdGlvbjwvbGk+CiAgPC91bD4KICA8YnV0dG9uIG9uY2xpY2s9ImNhbGxFbWVyZ2VuY3lTdXBwb3J0KCkiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNkOTUzNGY7Y29sb3I6d2hpdGU7cGFkZGluZzowLjc1ZW0gMS41ZW07Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo1cHg7Zm9udC13ZWlnaHQ6Ym9sZDtjdXJzb3I6cG9pbnRlcjsiPgogICAg8J+aqCBLb250YWt0IE7DuGRoasOmbHAKICA8L2J1dHRvbj4KPC9kaXY+YCwKICAgIH07CiAgICByZXR1cm4gYmFubmVyc1tsYW5ndWFnZV0gfHwgYmFubmVycy5lbjsKfTsKCmNvbnN0IGdldEVtZXJnZW5jeVNjcmlwdCA9ICgpID0+IHsKICAgIHJldHVybiBgCmZ1bmN0aW9uIGNhbGxFbWVyZ2VuY3lTdXBwb3J0KCkgewogIGZldGNoKCJodHRwczovL3lvdXItYXBpLmV4YW1wbGUuY29tL2VtZXJnZW5jeSIsIHsKICAgIG1ldGhvZDogIlBPU1QiLAogICAgaGVhZGVyczogewogICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iCiAgICB9LAogICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICBwYXRpZW50SWQ6ICIxMjM0NTYiLAogICAgICBkcnVnOiAiRnVyb3NlbWlkZSIsCiAgICAgIGNvbmRpdGlvbjogIkhlYXJ0IEZhaWx1cmUiLAogICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgcmVhc29uOiAiRW1lcmdlbmN5IHJlYWN0aW9uIHJlcG9ydGVkIHZpYSBlUEkgYWxlcnQiCiAgICB9KQogIH0pCiAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgaWYgKHJlc3BvbnNlLm9rKSB7CiAgICAgIGFsZXJ0KCJFbWVyZ2VuY3kgc3VwcG9ydCBoYXMgYmVlbiBub3RpZmllZC4iKTsKICAgIH0gZWxzZSB7CiAgICAgIGFsZXJ0KCJDb3VsZCBub3QgY29udGFjdCBzdXBwb3J0LiBQbGVhc2UgY2FsbCBlbWVyZ2VuY3kgc2VydmljZXMgZGlyZWN0bHkuIik7CiAgICB9CiAgfSkKICAuY2F0Y2goKCkgPT4gewogICAgYWxlcnQoIk5ldHdvcmsgZXJyb3IuIFBsZWFzZSBjYWxsIGVtZXJnZW5jeSBzZXJ2aWNlcyBkaXJlY3RseS4iKTsKICB9KTsKfQpgOwp9OwoKY29uc3QgaW5zZXJ0UXVlc3Rpb25uYWlyZUxpbmsgPSAoCiAgICBsaXN0T2ZDYXRlZ29yaWVzLAogICAgbGFuZ3VhZ2UsCiAgICBkb2N1bWVudCwKICAgIHJlc3BvbnNlCikgPT4gewogICAgbGV0IGxpbmtIVE1MID0gImh0dHBzOi8vZXhhbXBsZS5vcmcvcXVlc3Rpb25uYWlyZS9oaWdoLXJpc2siOwogICAgbGV0IHNob3VsZEFwcGVuZCA9IGZhbHNlOyAvL2ZvciBmdXR1cmUgdXNhZ2UKICAgIGxldCBmb3VuZENhdGVnb3J5ID0gZmFsc2U7CgogICAgbGlzdE9mQ2F0ZWdvcmllcy5mb3JFYWNoKChjbGFzc05hbWUpID0+IHsKICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmluY2x1ZGVzKGBjbGFzcz0iJHtjbGFzc05hbWV9ImApIHx8CiAgICAgICAgICAgIHJlc3BvbnNlLmluY2x1ZGVzKGBjbGFzcz0nJHtjbGFzc05hbWV9J2ApCiAgICAgICAgKSB7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgbGlua0hUTUwpOwogICAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoInRhcmdldCIsICJfYmxhbmsiKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJwcmVhZG1pc3Npb24tbGVucyIpOwoKICAgICAgICAgICAgICAgIGlmIChzaG91bGRBcHBlbmQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBcHBlbmQgdGhlIGxpbmsgYXMgYSBuZXcgZWxlbWVudCBpbnNpZGUgdGhlIGV4aXN0aW5nIGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICBsaW5rLmlubmVySFRNTCA9ICLwn5OdIEZpbGwgb3V0IHNhZmV0eSBxdWVzdGlvbm5haXJlIjsKICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCB0aGUgZXhpc3RpbmcgY29udGVudHMgb2YgdGhlIGVsZW1lbnQgaW4gdGhlIGxpbmsKICAgICAgICAgICAgICAgICAgICBsaW5rLmlubmVySFRNTCA9IGVsLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICBlbC5pbm5lckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3VuZENhdGVnb3J5ID0gdHJ1ZTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBObyBtYXRjaGluZyBjYXRlZ29yeSB0YWdzIOKGkiBpbmplY3QgYmFubmVyIGF0IHRvcAogICAgaWYgKCFmb3VuZENhdGVnb3J5KSB7CiAgICAgICAgY29uc3QgYmFubmVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGdldEJhbm5lckhUTUwobGFuZ3VhZ2UpOwogICAgICAgIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5Iik7CiAgICAgICAgaWYgKGJvZHkpIHsKICAgICAgICAgICAgYm9keS5pbnNlcnRCZWZvcmUoYmFubmVyRGl2LCBib2R5LmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyDinIUgQWRkIHRoZSBlbWVyZ2VuY3kgc2NyaXB0IG9uY2UsIG9ubHkgaWYgbm90IGFscmVhZHkgcHJlc2VudAogICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2FsbC1lbWVyZ2VuY3ktc2NyaXB0IikpIHsKICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICBzY3JpcHQuaWQgPSAiY2FsbC1lbWVyZ2VuY3ktc2NyaXB0IjsKICAgICAgICBzY3JpcHQudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICAgIHNjcmlwdC50ZXh0Q29udGVudCA9IGdldEVtZXJnZW5jeVNjcmlwdCgpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH0KCiAgICAvLyBDbGVhbiBoZWFkCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgIH0KCiAgICAvLyBFeHRyYWN0IEhUTUwgcmVzdWx0CiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsKICAgIH0gZWxzZSB7CiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MOwogICAgfQoKICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2UudHJpbSgpID09PSAiIikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQW5ub3RhdGlvbiBwcm9jZXNzIGZhaWxlZDogZW1wdHkgb3IgbnVsbCByZXNwb25zZSIpOwogICAgfQoKICAgIHJldHVybiByZXNwb25zZTsKfTsKCmxldCBlbmhhbmNlID0gYXN5bmMgKCkgPT4gewogICAgaWYgKCFlcGlEYXRhIHx8ICFlcGlEYXRhLmVudHJ5IHx8IGVwaURhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJlUEkgaXMgZW1wdHkgb3IgaW52YWxpZC4iKTsKICAgIH0KICAgIGxldCBsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2ggPSBbCiAgICAgICAgeyBjb2RlOiAiZ3Jhdi01Iiwgc3lzdGVtOiAiaHR0cHM6Ly93d3cuZ3Jhdml0YXRlaGVhbHRoLmV1L3NpZC9kb2MiIH0sCiAgICBdOyAvL3doYXQgdG8gbG9vayBpbiBleHRlbnNpb25zIC1tYWRlIHVwIGNvZGUgYmVjYXVzZSB0aGVyZSBpcyBub25lCgogICAgLy8gTWF0Y2ggbGlzdHMKICAgIGNvbnN0IEJVTkRMRV9JREVOVElGSUVSX0xJU1QgPSBbImVwaWJ1bmRsZS0xMjMiLCAiZXBpYnVuZGxlLWFiYyJdOwogICAgY29uc3QgUFJPRFVDVF9JREVOVElGSUVSX0xJU1QgPSBbIkNJVC0yMDQ0NDciLCAiUklTLTE5NzM2MSJdOwoKICAgIGxldCBtYXRjaEZvdW5kID0gZmFsc2U7CgogICAgZGV0ZWN0TGFuZ3VhZ2UoKTsKCiAgICAvLyBDaGVjayBidW5kbGUuaWRlbnRpZmllci52YWx1ZQogICAgaWYgKAogICAgICAgIGVwaURhdGEuaWRlbnRpZmllciAmJgogICAgICAgIEJVTkRMRV9JREVOVElGSUVSX0xJU1QuaW5jbHVkZXMoZXBpRGF0YS5pZGVudGlmaWVyLnZhbHVlKQogICAgKSB7CiAgICAgICAgbWF0Y2hGb3VuZCA9IHRydWU7CiAgICB9CgogICAgLy8gQ2hlY2sgTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24uaWRlbnRpZmllci52YWx1ZQogICAgZXBpRGF0YS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIk1lZGljaW5hbFByb2R1Y3REZWZpbml0aW9uIikgewogICAgICAgICAgICBjb25zdCBpZHMgPSByZXMuaWRlbnRpZmllciB8fCBbXTsKICAgICAgICAgICAgaWRzLmZvckVhY2goKGlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoUFJPRFVDVF9JREVOVElGSUVSX0xJU1QuaW5jbHVkZXMoaWQudmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hGb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIGVQSSB0cmFzbGF0aW9uIGZyb20gdGVybWlub2xvZ3kgY29kZXMgdG8gdGhlaXIgaHVtYW4gcmVkYWJsZSB0cmFuc2xhdGlvbnMgaW4gdGhlIHNlY3Rpb25zCiAgICAvLyBpbiB0aGlzIGNhc2UsIGlmIGlzIGRvZXMgbm90IGZpbmQgYSBwbGFjZSwgYWRkcyBpdCB0byB0aGUgdG9wIG9mIHRoZSBlUEkKICAgIGxldCBjb21wb3NpdGlvbnMgPSAwOwogICAgbGV0IGNhdGVnb3JpZXMgPSBbXTsKICAgIGVwaURhdGEuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICBpZiAoZW50cnkucmVzb3VyY2UucmVzb3VyY2VUeXBlID09ICJDb21wb3NpdGlvbiIpIHsKICAgICAgICAgICAgY29tcG9zaXRpb25zKys7CiAgICAgICAgICAgIC8vSXRlcmF0ZWQgdGhyb3VnaCB0aGUgQ29uZGl0aW9uIGVsZW1lbnQgc2VhcmNoaW5nIGZvciBjb25kaXRpb25zCiAgICAgICAgICAgIGVudHJ5LnJlc291cmNlLmV4dGVuc2lvbi5mb3JFYWNoKChlbGVtZW50KSA9PiB7CiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgcG9zaXRpb24gb2YgdGhlIGV4dGVuc2lvblsxXSBpcyBjb3JyZWN0CiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5leHRlbnNpb25bMV0udXJsID09ICJjb25jZXB0IikgewogICAgICAgICAgICAgICAgICAgIC8vIFNlYXJjaCB0aHJvdWdoIHRoZSBkaWZmZXJlbnQgdGVybWlub2xvZ2llcyB0aGF0IG1heSBiZSBhdmFpYmxlIHRvIGNoZWNrIGluIHRoZSBjb25kaXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPQogICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0LmNvZGluZy5mb3JFYWNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvZGluZykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjb2RlIGlzIGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2guc29tZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpdGVtKSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29kZSA9PT0gY29kaW5nLmNvZGUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnN5c3RlbSA9PT0gY29kaW5nLnN5c3RlbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjYXRlZ29yeSBpcyBhbHJlYWR5IGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoY29tcG9zaXRpb25zID09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBlUEk6IG5vIGNhdGVnb3J5ICJDb21wb3NpdGlvbiIgZm91bmQnKTsKICAgIH0KCiAgICBpZiAoIW1hdGNoRm91bmQpIHsKICAgICAgICByZXR1cm4gaHRtbERhdGE7CiAgICB9IGVsc2UgewogICAgICAgIGxldCByZXNwb25zZSA9IGh0bWxEYXRhOwogICAgICAgIGxldCBkb2N1bWVudDsKCiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsKICAgICAgICAgICAgbGV0IHsgSlNET00gfSA9IGpzZG9tOwogICAgICAgICAgICBsZXQgZG9tID0gbmV3IEpTRE9NKGh0bWxEYXRhKTsKICAgICAgICAgICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50OwogICAgICAgICAgICByZXR1cm4gaW5zZXJ0UXVlc3Rpb25uYWlyZUxpbmsoCiAgICAgICAgICAgICAgICBjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgbGFuZywKICAgICAgICAgICAgICAgIGRvY3VtZW50LAogICAgICAgICAgICAgICAgcmVzcG9uc2UKICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKICAgICAgICAgICAgcmV0dXJuIGluc2VydFF1ZXN0aW9ubmFpcmVMaW5rKAogICAgICAgICAgICAgICAgY2F0ZWdvcmllcywKICAgICAgICAgICAgICAgIGxhbmcsCiAgICAgICAgICAgICAgICBkb2N1bWVudCwKICAgICAgICAgICAgICAgIHJlc3BvbnNlCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQp9OwoKcmV0dXJuIHsKICAgIGVuaGFuY2U6IGVuaGFuY2UsCiAgICBnZXRTcGVjaWZpY2F0aW9uOiBnZXRTcGVjaWZpY2F0aW9uLAogICAgZXhwbGFuYXRpb246IChsYW5ndWFnZSkgPT4gZ2V0RXhwbGFuYXRpb24obGFuZ3VhZ2UgfHwgbGFuZyB8fCAiZW4iKSwKICAgIHJlcG9ydDogKGxhbmd1YWdlKSA9PiBnZXRSZXBvcnQobGFuZ3VhZ2UgfHwgbGFuZyB8fCAiZW4iKSwKfTs="
    }
  ]
}